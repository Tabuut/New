<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒŸ Elite Player Rankings & Team Builder</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background-color: #1e1e2f; 
      color: #f0f0f0; 
      padding: 20px;
      margin: 0;
      direction: rtl; /* Ensure RTL layout */
    }
    h2 { 
      color: #ffd700; 
      font-size: 28px; 
      border-bottom: 2px solid #ffd700; 
      padding-bottom: 5px;
      text-align: center;
      margin-top: 40px;
    }
    h3 { 
      color: #00ffff; 
      margin-top: 30px; 
      font-size: 22px; 
      border-right: 5px solid #00ffff; /* RTL adjustment */
      padding-right: 10px;
      padding-left: 0;
      text-align: right;
    }
    ul { 
      list-style: none; 
      padding-right: 0; /* RTL adjustment */
    }
    li { 
      background: #2e2e3e; 
      margin: 6px 0; 
      padding: 10px 15px; 
      border-radius: 8px; 
      box-shadow: 0 0 5px #000;
      transition: transform 0.2s;
      text-align: right;
    }
    li:hover {
      transform: translateX(-5px); /* RTL adjustment */
      background: #3e3e4e;
    }
    li::before { 
      font-weight: bold;
      margin-left: 8px; /* RTL adjustment */
      margin-right: 0;
    }

    /* --- Level Icons (FIXED & Restored) --- */
    .level-container li::before { content: "â­"; } /* Default */
    .level30 li::before { content: "ğŸ”¥"; }
    .level29 li::before { content: "âš”ï¸"; }
    .level28 li::before { content: "ğŸ›¡ï¸"; }
    .level27 li::before { content: "ğŸ°"; }
    .level26 li::before { content: "ğŸ§±"; }
    
    /* Teams Styling */
    .teams-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .team {
      background: linear-gradient(135deg, #2e2e3e 0%, #1e1e2e 100%);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      border: 2px solid;
    }
    .team h4 {
      margin: 0 0 15px 0;
      font-size: 20px;
      text-align: center;
      padding: 10px;
      border-radius: 8px;
    }
    .team li {
      background: #3e3e4e;
      font-size: 13px;
      padding: 6px 10px;
      margin: 4px 0;
      border-right: 4px solid #ffd700; /* Team list styling */
      border-left: none;
    }
    .team li::before {
      content: "â­";
      margin-left: 5px;
    }
    .team-total {
      text-align: center;
      margin-top: 15px;
      padding: 10px;
      background: #1e1e2e;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      color: #ffd700;
      border: 1px solid #555;
    }
    
    /* Hero Section Styles (Static) */
    .hero-section {
      background: linear-gradient(135deg, #2a2a3e 0%, #1a1a2e 100%);
      border-radius: 15px;
      padding: 25px;
      margin: 30px 0;
      border: 2px solid #ffd700;
    }
    /* ... (rest of static hero guide CSS) ... */

    /* Helper classes for dynamic background/color (FIXED) */
    .color-ff6b6b { background: #ff6b6b; color: #fff; }
    .color-4ecdc4 { background: #4ecdc4; color: #fff; }
    .color-ffe66d { background: #ffe66d; color: #1e1e2f; }
    .color-a8e6cf { background: #a8e6cf; color: #1e1e2f; }
    .color-c7ceea { background: #c7ceea; color: #1e1e2f; }

    /* Toggle & Visibility */
    .scenario-toggle { text-align: center; margin: 30px 0; background: #2a2a3e; padding: 15px; border-radius: 15px; border: 1px solid #444; }
    .scenario-toggle button { background: #444; color: #ccc; border: none; padding: 12px 30px; margin: 0 10px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; }
    .scenario-toggle button.active { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; box-shadow: 0 0 15px rgba(245, 87, 108, 0.5); }
    .scenario { display: none; animation: fadeIn 0.5s ease-in-out; }
    .scenario.active { display: block; }

  </style>
</head>
<body>

<h2>ğŸ§  Elite Player Rankings â€“ Sorted by Level & Power</h2>

<div id="playerRankingsContainer" style="height: 300px; overflow-y: scroll; background: #1a1a20; padding: 15px; border-radius: 10px; border: 1px solid #444; margin-bottom: 30px;">
  <p style="text-align: center; color: #888; font-size: 12px;">(Scroll to see full list)</p>
  <div id="L30-list"></div>
  <div id="L29-list"></div>
  <div id="L28-list"></div>
  <div id="L27-list"></div>
  <div id="L26-list"></div>
</div>


<h2>ğŸ¦¸ Season 2 Hero Guide: Attack & Garrison Formations</h2>
<div class="hero-section">
  <h3 style="text-align: center; color: #ffd700; margin-top: 0;">âš”ï¸ Understanding Joiner Hero Mechanics</h3>
  
  <div class="info-box">
    <h5>ğŸ“– How Joiner Heroes Work</h5>
    <p>When you join a rally or garrison, only your <strong>FIRST SLOT hero</strong> counts as the "joiner hero". Up to 4 joiner heroes can contribute their skills to boost the rally/garrison. The key is understanding how their buffs stack!</p>
  </div>

  <div class="math-formula">
    <strong>SkillMod Formula:</strong><br>
    SkillMod = (DamageUp Ã— OppDefenseDown) / (OppDamageDown Ã— DefenseUp)
  </div>
  </div>


<h2>âš”ï¸ Balanced Team Formations</h2>

<div class="scenario-toggle">
  <button onclick="toggleScenario('with_irish')" class="active" id="btn_with_irish">ğŸ”¥ With Irish Rogue</button>
  <button onclick="toggleScenario('without_irish')" id="btn_without_irish">âš¡ Without Irish Rogue</button>
</div>

<div id="with_irish" class="scenario active">
  <h3 id="with_irish_title" style="text-align: center; color: #ffd700;"></h3>
  <div id="teamsContainerWith" class="teams-container">
    </div>
</div>

<div id="without_irish" class="scenario">
  <h3 id="without_irish_title" style="text-align: center; color: #ffd700;"></h3>
  <div id="teamsContainerWithout" class="teams-container">
    </div>
</div>


<script>
  // Helper function to parse power (e.g., "213.2M" -> 213200000)
  function parsePower(powerStr) {
    if (typeof powerStr !== 'string') return 0;
    const value = parseFloat(powerStr.replace('M', '').replace(',', '')); // Added replace for commas just in case
    return isNaN(value) ? 0 : value * 1000000;
  }

  // Function to format the total power
  function formatPower(power) {
    const powerInMillions = power / 1000000;
    return powerInMillions.toFixed(1).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 'M';
  }

  // Function to dynamically generate the Player Rankings list (FIXED)
  function renderPlayerLists(playersData) {
    const levelIcons = {
      '30': "ğŸ”¥", '29': "âš”ï¸", '28': "ğŸ›¡ï¸", '27': "ğŸ°", '26': "ğŸ§±"
    };

    // Keys are strings '30', '29', etc. Sort them numerically descending.
    const sortedLevels = Object.keys(playersData).sort((a, b) => parseInt(b) - parseInt(a));

    sortedLevels.forEach(level => {
      let html = `<h3>${levelIcons[level]} Level ${level}</h3><ul class="level-container level${level}">`;
      
      playersData[level].forEach(player => {
        html += `<li>${player.name} â€“ ${player.power}</li>`;
      });
      
      html += `</ul>`;
      
      const targetElement = document.getElementById(`L${level}-list`);
      if (targetElement) {
          targetElement.innerHTML = html;
      }
    });
  }

  // Function to dynamically generate the Team Formations (FIXED)
  function renderTeams(scenarioData, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    // Set the scenario title
    const titleElement = document.getElementById(containerId.replace('teamsContainer', '') + '_title');
    if (titleElement) {
        titleElement.textContent = scenarioData.name;
    }

    let teamCounter = 1;
    scenarioData.teams.forEach(team => {
      let listItems = '';
      let totalPower = 0;

      team.players.forEach(player => {
        totalPower += parsePower(player.power);
        // Use the color attribute for the leader name for better visibility
        const leaderStyle = player.isLeader ? `style="color: #${team.color}; font-weight: bold;"` : '';
        listItems += `<li ${leaderStyle}>${player.name} â€“ ${player.power}</li>`;
      });

      // Simple, robust HTML generation using helper classes for background colors
      const teamCard = `
        <div class="team" style="border-color: #${team.color};">
          <h4 class="color-${team.color}">${team.name}</h4>
          <ul>${listItems}</ul>
          <div class="team-total">ğŸ’ª Power: ~${formatPower(totalPower)}</div>
        </div>
      `;
      container.innerHTML += teamCard;
      teamCounter++;
    });
  }

  // Main function to load all data
  async function loadDataAndRender() {
    try {
      // Fetch the JSON data file
      const response = await fetch('players_data.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const data = await response.json();

      // 1. Render Player Rankings List (L30-L26)
      renderPlayerLists(data.all_players_by_level);

      // 2. Render Team Scenarios (Both, but only one is visible)
      renderTeams(data.scenarios.with_irish, 'teamsContainerWith');
      renderTeams(data.scenarios.without_irish, 'teamsContainerWithout');

      // 3. Ensure the initial scenario is visible and button is active
      toggleScenario('with_irish');

    } catch (error) {
      console.error('CRITICAL ERROR loading data:', error);
      // Display a clear error message to the user
      const errorHTML = '<p style="color:#ff6b6b; text-align:center; font-size:16px;">âš ï¸ Ø®Ø·Ø£ ÙØ§Ø¯Ø­ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù players_data.json ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯.</p>';
      document.getElementById('playerRankingsContainer').innerHTML = errorHTML;
      document.getElementById('teamsContainerWith').innerHTML = errorHTML;
      document.getElementById('teamsContainerWithout').innerHTML = '';
    }
  }

  // Function for the toggle buttons (Fixed)
  function toggleScenario(scenarioId) {
    // Hide all scenarios
    document.getElementById('with_irish').classList.remove('active');
    document.getElementById('without_irish').classList.remove('active');
    
    // Deactivate all buttons
    document.getElementById('btn_with_irish').classList.remove('active');
    document.getElementById('btn_without_irish').classList.remove('active');
    
    // Show the selected scenario
    const scenarioElement = document.getElementById(scenarioId);
    if(scenarioElement) {
        scenarioElement.classList.add('active');
    }
    
    // Activate the corresponding button
    const buttonElement = document.getElementById(`btn_${scenarioId}`);
    if(buttonElement) {
        buttonElement.classList.add('active');
    }
  }

  // Start the loading process when the window finishes loading
  window.onload = loadDataAndRender;

</script>
</body>
</html>
